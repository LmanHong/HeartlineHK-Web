(this["webpackJsonpheartlinehk-admin"]=this["webpackJsonpheartlinehk-admin"]||[]).push([[0],{35:function(e,t,n){},37:function(e,t,n){},39:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),s=n(28),c=n.n(s),o=(n(35),n(8)),i=n.n(o),l=n(13),u=n(6),d=n(16),m=n(7),b=(n(37),n(1)),h=function(e){return Object(b.jsx)("div",{id:e.modalId?e.modalId:"default-modal",className:"modal-container",children:Object(b.jsxs)("form",{className:"confirm-modal",onSubmit:e.formSubmitHandler,children:[Object(b.jsx)("p",{className:"confirm-text",children:e.confirmText?e.confirmText:"Changes might be lost if you leave now. Confirm?"}),Object(b.jsx)("button",{type:"submit",name:"confirm-btn",className:"confirm-btn",onClick:e.formSubmitHandler,children:"\u78ba\u5b9a"}),Object(b.jsx)("button",{type:"submit",name:"cancel-btn",className:"cancel-btn",onClick:e.formSubmitHandler,children:"\u53d6\u6d88"})]})})},f=n.p+"static/media/logo_80x80.6314ce1a.png",g=(n(39),n(5)),j=(n(18),n(19),function(e){var t=Object(r.useRef)(),n=Object(r.useRef)(),a=Object(r.useState)(!1),s=Object(u.a)(a,2),c=s[0],o=s[1],i=function(){t.current.style.transitionDuration="0.5s",t.current.classList.remove("opened"),n.current.classList.remove("opened")};return Object(r.useEffect)((function(){g.a.database().ref("supervisors").child(e.currentUser.uid).once("value",(function(e){null!=e.val()?o(!0):o(!1)}))}),[]),Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{className:"nav-toggle-btn",onClick:function(){t.current.style.transitionDuration="0.5s",t.current.classList.add("opened"),n.current.classList.add("opened")},children:Object(b.jsx)("span",{className:"material-icons",children:"menu"})}),Object(b.jsxs)("nav",{className:"nav-container",ref:t,children:[Object(b.jsxs)("a",{href:"#",className:"nav-logo",children:[Object(b.jsx)("img",{src:f,alt:f,className:"front"}),Object(b.jsx)("p",{className:"nav-name",children:"HEARTLINEHK"})]}),Object(b.jsxs)("ul",{className:"nav-items-container",children:[Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsxs)(d.b,{to:"/",className:"nav-link",onClick:i,children:[Object(b.jsx)("span",{className:"material-icons",children:"home"})," \u8cc7\u8a0a\u7248\u9762"]})}),Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsxs)(d.b,{to:"/chatroom",className:"nav-link",onClick:i,children:[Object(b.jsx)("span",{className:"material-icons",children:"chat"})," \u804a\u5929\u5ba4"]})}),Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsxs)(d.b,{to:"/profile-update",className:"nav-link",onClick:i,children:[Object(b.jsx)("span",{className:"material-icons",children:"badge"})," \u66f4\u6539\u500b\u4eba\u8cc7\u6599"]})}),c&&Object(b.jsx)("li",{className:"nav-item",children:Object(b.jsxs)(d.b,{to:"/supervisor",className:"nav-link",onClick:i,children:[Object(b.jsx)("span",{className:"material-icons",children:"question_answer"})," \u7ba1\u7406\u54e1\u7248\u9762"]})})]}),Object(b.jsxs)("div",{className:"nav-user",onClick:e.handleLogout,children:[Object(b.jsx)("img",{src:"https://t4.ftcdn.net/jpg/02/34/61/79/360_F_234617921_p1AGQkGyEl8CSzwuUI74ljn6IZXqMUf2.jpg",alt:""}),Object(b.jsx)("a",{className:"username",children:e.currentUser.displayName})]})]}),Object(b.jsx)("div",{ref:n,className:"nav-background",onClick:i})]})}),v=(n(48),function(e){var t=Object(r.useRef)(),n=function(){var n=Object(l.a)(i.a.mark((function n(r){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.preventDefault(),n.prev=1,!e.currentUser){n.next=14;break}if(""==(a=t.current.value)){n.next=11;break}return n.next=7,e.currentUser.updateProfile({displayName:a});case 7:t.current.value="",alert("Profile Update Successful!"),n.next=12;break;case 11:throw new Error("New Display Name is null!");case 12:n.next=15;break;case 14:throw new Error("Current User is null!");case 15:n.next=21;break;case 17:n.prev=17,n.t0=n.catch(1),console.error("ERROR: "+n.t0.message),alert(n.t0.message);case 21:case"end":return n.stop()}}),n,null,[[1,17]])})));return function(e){return n.apply(this,arguments)}}();return Object(b.jsx)("div",{className:"profile-update",children:Object(b.jsxs)("form",{className:"update-form",onSubmit:n,children:[Object(b.jsx)("label",{htmlFor:"display-name-input",children:"\u65b0\u986f\u793a\u540d\u7a31"}),Object(b.jsx)("input",{ref:t,type:"text",name:"display-name-input",id:"display-name-input"}),Object(b.jsx)("button",{type:"submit",children:"\u66f4\u6539\u8cc7\u6599"})]})})}),p=(n(49),function(e){var t={clientLeft:"\u4f7f\u7528\u8005\u5df2\u96e2\u958b\u804a\u5929\u5ba4",volunLeft:"\u7fa9\u5de5\u5df2\u96e2\u958b\u804a\u5929\u5ba4",clientId:"\u7fa9\u5de5\u5df2\u958b\u555f\u804a\u5929\u5ba4"},n=g.a.database().ref("room_assigned"),a=g.a.database().ref("disconnect_time"),s=g.a.database().ref("chat_log"),c=Object(r.useRef)(null),o=Object(r.useState)(null),i=Object(u.a)(o,2),l=i[0],d=i[1],m=Object(r.useState)([]),h=Object(u.a)(m,2),f=h[0],j=h[1],v=Object(r.useState)([]),p=Object(u.a)(v,2),x=p[0],O=p[1],k=Object(r.useState)(!1),w=Object(u.a)(k,2),S=(w[0],w[1]),y=function(e){var t=[];if(console.log(e.val()),null!=e.val())for(var n in e.val())t.push({chatId:n,uid:e.val()[n].uid,time:e.val()[n].time,msg:e.val()[n].msg,spc:e.val()[n].spc});console.log(t),O(t)},N=function(e){var t=[];if(null!=e.val())for(var n in e.val())"volunLeft"!=e.val()[n]&&t.push({clientId:n,volunId:e.val()[n]});console.log(t),j(t)},E=function(e){d(e.val())},R=function(e){var t=e.target.value,n=e.target.innerHTML;console.log(t),console.log(n);var r=sessionStorage.getItem("heartlinehk-supervisor-currentVolun"),c=sessionStorage.getItem("heartlinehk-supervisor-currentClient");r&&s.child(r).orderByChild("time").off("value"),c&&a.child(c).off("value"),sessionStorage.setItem("heartlinehk-supervisor-currentClient",t),sessionStorage.setItem("heartlinehk-supervisor-currentVolun",n),s.child(n).orderByChild("time").on("value",y),a.child(t).on("value",E)},C=function(e){var t=new Date(e),n=t.getHours()<10?"0"+t.getHours().toString():t.getHours().toString(),r=t.getMinutes()<10?"0"+t.getMinutes().toString():t.getMinutes().toString(),a=t.getMonth()<9?"0"+(t.getMonth()+1).toString():(t.getMonth()+1).toString();return n+":"+r+", "+(t.getDate()<10?"0"+t.getDate().toString():t.getDate().toString())+"/"+a};return Object(r.useEffect)((function(){return g.a.database().ref("supervisors").child(e.currentUser.uid).once("value",(function(e){null!=e.val()?S(!0):S(!1)})),n.on("value",N),function(){console.log("Supervisor Unmounted!"),n.off("value");var e=sessionStorage.getItem("heartlinehk-supervisor-currentVolun"),t=sessionStorage.getItem("heartlinehk-supervisor-currentClient");e&&(s.child(e).orderByChild("time").off("value"),sessionStorage.removeItem("heartlinehk-supervisor-currentVolun")),t&&(a.child(t).off("value"),sessionStorage.removeItem("heartlinehk-supervisor-currentClient"))}}),[]),Object(r.useEffect)((function(){x.length>0&&c.current.scrollTo(0,c.current.scrollHeight)}),[x]),Object(b.jsxs)("div",{className:"supervisor",children:[Object(b.jsx)("div",{className:"volunteers-container",children:f.map((function(e,t){var n=sessionStorage.getItem("heartlinehk-supervisor-currentVolun");return Object(b.jsx)("button",{className:"volun-btn"+(n===e.volunId?" selected":""),onClick:R,value:e.clientId,children:e.volunId},e.clientId)}))}),null!=l&&Object(b.jsxs)("p",{className:"disconnect-msg",children:["\u4f7f\u7528\u8005\u5df2\u65bc",C(l),"\u958b\u59cb\u96e2\u7dda\u3002"]}),Object(b.jsx)("div",{ref:c,className:"chat-container",children:x.length>0&&x.map((function(e,n){var r=sessionStorage.getItem("heartlinehk-supervisor-currentVolun");return Object(b.jsxs)("p",{className:"message "+(e.spc?"special":e.uid===r?"right":"left"),children:[e.msg?e.msg:t[e.spc]?t[e.spc]:t.clientId,Object(b.jsx)("span",{children:C(e.time)})]},e.chatId)}))})]})}),x=(n(50),function(){return Object(b.jsx)("div",{className:"loading",children:Object(b.jsx)("div",{className:"spinning-circle"})})}),O=n(30),k=n.n(O),w=(n(51),n.p+"static/media/pristine-609.9287f5ce.mp3"),S=function(e){var t={clientLeft:"\u4f7f\u7528\u8005\u5df2\u96e2\u958b\u804a\u5929\u5ba4",volunLeft:"\u7fa9\u5de5\u5df2\u96e2\u958b\u804a\u5929\u5ba4",clientId:"\u7fa9\u5de5\u5df2\u958b\u555f\u804a\u5929\u5ba4"},n=g.a.database().ref("chat_queue"),a=g.a.database().ref("room_assigned"),s=g.a.database().ref("disconnect_time"),c=g.a.database().ref("typing_status"),o=g.a.database().ref("chat_log/".concat(e.currentUser.uid)),d="https://docs.google.com/forms/d/e/1FAIpQLSdsD_qLU51OC9UY0Rrx_Ht52aU0TgPU-LUu5yNp4ta8cYu0yQ/viewform?usp=pp_url",m="entry.1533999842",f="entry.240218030",j="entry.1133078412",v=Object(r.useRef)(null),p=Object(r.useRef)(null),O=Object(r.useState)([]),S=Object(u.a)(O,2),y=S[0],N=S[1],E=Object(r.useState)(null),R=Object(u.a)(E,2),C=R[0],I=R[1],M=Object(r.useState)(null),D=Object(u.a)(M,2),H=D[0],U=D[1],L=Object(r.useState)([]),A=Object(u.a)(L,2),T=A[0],_=A[1],q=Object(r.useState)(!1),B=Object(u.a)(q,2),P=B[0],F=B[1],Q=Object(r.useState)(!1),V=Object(u.a)(Q,2),G=V[0],z=V[1],Y=Object(r.useState)(!1),K=Object(u.a)(Y,2),W=K[0],J=K[1],X=Object(r.useState)(!1),Z=Object(u.a)(X,2),$=Z[0],ee=Z[1],te=Object(r.useState)(!1),ne=Object(u.a)(te,2),re=ne[0],ae=ne[1],se=Object(r.useState)(!1),ce=Object(u.a)(se,2),oe=ce[0],ie=ce[1],le=Object(r.useState)(!1),ue=Object(u.a)(le,2),de=ue[0],me=ue[1],be=function(e){var t=[];if(console.log(e.val()),null!=e.val())for(var n in e.val())t.push({chatId:n,uid:e.val()[n].uid,time:e.val()[n].time,msg:e.val()[n].msg,spc:e.val()[n].spc});console.log(t),_(t)},he=function(e){var t=[],n=!1,r=document.querySelectorAll(".chatroom .queue-container .clients-container .queue-client .client-id");if(console.log(e.val()),null!=e.val()){var a=function(a){if(t.push({userId:a,status:e.val()[a].status,time:e.val()[a].time}),!n){var s=!1;r.forEach((function(e){e.innerHTML===a&&(s=!0)})),n=!s}};for(var s in e.val())a(s);for(var c=0;c<t.length;c++)for(var o=0;o<t.length-c-1;o++)if(t[o].time>t[o+1].time){var i=t[o];t[o]=t[o+1],t[o+1]=i}}n&&new Audio(w).play();console.log(t),N(t)},fe=function(e){U(e.val())},ge=function(e){ae(e.val())},je=function(){var t=Object(l.a)(i.a.mark((function t(){var r,l,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n.orderByChild("time").on("value",he),o.orderByChild("time").on("value",be),r=sessionStorage.getItem("heartlinehk-currentClient"),t.next=6,a.once("value");case 6:l=t.sent,t.t0=i.a.keys(l.val());case 8:if((t.t1=t.t0()).done){t.next=16;break}if(u=t.t1.value,l.val()[u]!==e.currentUser.uid){t.next=14;break}return null!==r&&r!==u&&console.warn("WARNING: updating local current client as it is different from database!"),r=u,t.abrupt("break",16);case 14:t.next=8;break;case 16:null!=r?(s.child(r).on("value",fe),c.child(r).on("value",ge),I(r),sessionStorage.setItem("heartlinehk-currentClient",r)):console.warn("WARNING: No client is assigned to the current volunteer!"),t.next=22;break;case 19:t.prev=19,t.t2=t.catch(0),console.error("ERROR: "+t.t2.message);case 22:case"end":return t.stop()}}),t,null,[[0,19]])})));return function(){return t.apply(this,arguments)}}(),ve=function(){var t=Object(l.a)(i.a.mark((function t(r){var l,u,d,m,b,h,f,j,v,p,x,O,k,w,S,y;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=0,u=null,d=null,t.prev=3,!P){t.next=6;break}throw new Error("Already starting a new chat!");case 6:if(F(!0),n){t.next=12;break}throw F(!1),new ReferenceError("Chat Queue reference not available!");case 12:if(a){t.next=17;break}throw F(!1),new ReferenceError("Room Assigned reference not available!");case 17:if(o){t.next=22;break}throw F(!1),new ReferenceError("Chat Room reference not available!");case 22:if(s){t.next=27;break}throw F(!1),new ReferenceError("Disconnect Time reference not available!");case 27:if(c){t.next=32;break}throw F(!1),new ReferenceError("Typing Status reference not available!");case 32:if(null==C){t.next=37;break}throw F(!1),new Error("CurrentClient is already set!");case 37:return t.next=39,n.orderByChild("time").once("value");case 39:if(m=t.sent,b=[],null!=m.val()){for(h in m.val())b.push({userId:h,status:m.val()[h].status,time:m.val()[h].time});for(f=0;f<b.length;f++)for(j=0;j<b.length-f-1;j++)b[j].time>b[j+1].time&&(v=b[j],b[j]=b[j+1],b[j+1]=v)}t.t0=i.a.keys(b);case 43:if((t.t1=t.t0()).done){t.next=51;break}if(p=t.t1.value,"inQueue"!==b[p].status){t.next=49;break}return u=b[p].userId,d=b[p].time,t.abrupt("break",51);case 49:t.next=43;break;case 51:if(null!==u){t.next=54;break}throw F(!1),new RangeError("No available client in chat queue!");case 54:return x=n.child(u),t.next=57,x.transaction((function(e){return null===e?void console.error("ERROR: Required Queue Client is Null!"):"roomAssigned"===e.status?void console.error("ERROR: Required Queue Client has already assigned a room!"):"inQueue"===e.status?{status:"roomAssigned",time:g.a.database.ServerValue.TIMESTAMP}:void console.error("Unknown Error!")}));case 57:if(!(O=t.sent).error){t.next=63;break}throw F(!1),new Error(O.error);case 63:if(O.committed){t.next=66;break}throw F(!1),new Error("Client Queue Transaction Aborted!");case 66:return l+=1,k=a.child(u),t.next=70,k.transaction((function(t){return null===t?e.currentUser.uid:void console.error("ERROR: Client to be assigned has a non-null volunteer ID!")}));case 70:if(!(w=t.sent).error){t.next=76;break}throw F(!1),new Error(w.error);case 76:if(w.committed){t.next=79;break}throw F(!1),new Error("Client Room Assigned Transaction Aborted!");case 79:return l+=1,t.next=82,o.once("value");case 82:if(null==t.sent.val()){t.next=86;break}return t.next=86,o.remove();case 86:return l+=1,t.next=89,o.push();case 89:return S=t.sent,t.next=92,S.transaction((function(t){return null===t?{uid:e.currentUser.uid,time:g.a.database.ServerValue.TIMESTAMP,spc:u}:void console.error("ERROR: Initial Message is not null!")}));case 92:if(!(y=t.sent).error){t.next=98;break}throw F(!1),new Error(y.error);case 98:if(y.committed){t.next=101;break}throw F(!1),new Error("Initial Message Transaction Aborted!");case 101:l+=1,sessionStorage.setItem("heartlinehk-currentClient",u),I(u),s.child(u).on("value",fe),c.child(u).on("value",ge),F(!1);case 107:t.next=120;break;case 109:if(t.prev=109,t.t2=t.catch(3),console.error("ERROR: "+t.t2.message),!(l>=1)){t.next=115;break}return t.next=115,n.child(u).set({status:"inQueue",time:d});case 115:if(!(l>=2)){t.next=118;break}return t.next=118,a.child(u).remove();case 118:l>=4&&(sessionStorage.setItem("heartlinehk-currentClient",u),I(u),F(!1)),alert(t.t2.message);case 120:case"end":return t.stop()}}),t,null,[[3,109]])})));return function(e){return t.apply(this,arguments)}}(),pe=function(){var t=Object(l.a)(i.a.mark((function t(){var r,l,u,b,h,g,v,p,x,O,k,w,S,y,N,E,R,M,D,H,L,A,T,q,B,P,F,Q,V,Y,K;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=0,l=!1,u=0,b=0,t.prev=4,!G){t.next=7;break}throw new Error("Already ending a chat!");case 7:if(z(!0),a){t.next=13;break}throw z(!1),new ReferenceError("Room Assigned reference not available!");case 13:if(o){t.next=18;break}throw z(!1),new ReferenceError("Chat Room reference not available!");case 18:if(s){t.next=23;break}throw z(!1),new ReferenceError("Disconnect Time reference not available!");case 23:if(c){t.next=28;break}throw z(!1),new ReferenceError("Typing Status reference not available!");case 28:if(null!=C){t.next=33;break}throw z(!1),new Error("Current Client is null!");case 33:return t.next=35,a.child(C).once("value");case 35:return h=t.sent,g=null===h.val(),t.next=39,o.once("value");case 39:if(v=t.sent.val(),p=!1,null==v){t.next=50;break}t.t0=i.a.keys(v);case 43:if((t.t1=t.t0()).done){t.next=50;break}if(x=t.t1.value,"clientLeft"!==v[x].spc){t.next=48;break}return p=!0,t.abrupt("break",50);case 48:t.next=43;break;case 50:return t.next=52,n.child(C).once("value");case 52:if(t.t2=t.sent.val(),O=null!=t.t2,console.log(g,p,O),r+=1,l=g||p){t.next=64;break}if(g){t.next=61;break}return t.next=61,a.child(C).set("volunLeft");case 61:if(!O){t.next=64;break}return t.next=64,n.child(C).remove();case 64:return r+=1,t.next=67,o.orderByChild("time").limitToFirst(1).once("value");case 67:for(w in k=t.sent.val())u=k[w].time;return b=Date.now(),t.next=72,o.transaction((function(e){return null!=e?null:void console.error("ERROR: Chat Log in Chatroom already null!")}));case 72:if(!(S=t.sent).error){t.next=78;break}throw z(!1),new Error(S.error);case 78:if(S.committed){t.next=81;break}throw z(!1),new Error("Chatrom Transaction Aborted!");case 81:return _([]),r+=1,t.next=85,c.child(e.currentUser.uid).remove();case 85:s.child(C).off("value"),U(null),c.child(C).off("value"),ae(!1),sessionStorage.removeItem("heartlinehk-currentClient"),I(null),z(!1),y=new Date(u),N=y.getHours()<10?"0"+y.getHours().toString():y.getHours().toString(),E=y.getMinutes()<10?"0"+y.getMinutes().toString():y.getMinutes().toString(),R=new Date(b),M=R.getHours()<10?"0"+R.getHours().toString():R.getHours().toString(),D=R.getMinutes()<10?"0"+R.getMinutes().toString():R.getMinutes().toString(),H=R.getMonth()+1<10?"0"+(R.getMonth()+1).toString():(R.getMonth()+1).toString(),L=R.getDate()<10?"0"+R.getDate().toString():R.getDate().toString(),A=d+"&"+m+"="+R.getFullYear()+"-"+H+"-"+L+"&"+f+"="+N+":"+E+"&"+j+"="+M+":"+D,window.open(A,"ChatRecordForm","resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no,status=yes");case 102:t.next=113;break;case 104:if(t.prev=104,t.t3=t.catch(4),console.error("ERROR: "+t.t3.message),!(r>=2)){t.next=111;break}if(l){t.next=111;break}return t.next=111,a.child(C).set(e.currentUser.uid);case 111:r>=3&&(s.child(C).off("value"),U(null),c.child(C).off("value"),ae(!1),sessionStorage.removeItem("heartlinehk-currentClient"),I(null),T=new Date(u),q=T.getHours()<10?"0"+T.getHours().toString():T.getHours().toString(),B=T.getMinutes()<10?"0"+T.getMinutes().toString():T.getMinutes().toString(),P=new Date(b),F=P.getHours()<10?"0"+P.getHours().toString():P.getHours().toString(),Q=P.getMinutes()<10?"0"+P.getMinutes().toString():P.getMinutes().toString(),V=P.getMonth()+1<10?"0"+(P.getMonth()+1).toString():(P.getMonth()+1).toString(),Y=P.getDate()<10?"0"+P.getDate().toString():P.getDate().toString(),K=d+"&"+m+"="+P.getFullYear()+"-"+V+"-"+Y+"&"+f+"="+q+":"+B+"&"+j+"="+F+":"+Q,window.open(K,"ChatRecordForm","resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no,status=yes")),alert(t.t3.message);case 113:case"end":return t.stop()}}),t,null,[[4,104]])})));return function(){return t.apply(this,arguments)}}(),xe=function(){var t=Object(l.a)(i.a.mark((function t(n){var r,a,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),t.prev=1,!W){t.next=4;break}throw new Error("Already sending a message!");case 4:if(J(!0),null!==C){t.next=8;break}throw J(!1),new Error("Current Client is null!");case 8:if(null!==(r=document.getElementById("msg-input").value)&&""!==r){t.next=14;break}throw J(!1),new Error("Message to be sent is empty!");case 14:if(o){t.next=19;break}throw J(!1),new ReferenceError("Chatroom reference not available!");case 19:if(c){t.next=24;break}throw J(!1),new ReferenceError("Typing Status reference not available!");case 24:return t.next=26,o.push();case 26:return a=t.sent,t.next=29,a.transaction((function(t){return null===t?{uid:e.currentUser.uid,time:g.a.database.ServerValue.TIMESTAMP,msg:r}:void console.error("ERROR: New Message is not null!")}));case 29:if(!(s=t.sent).error){t.next=35;break}throw J(!1),new Error(s.error);case 35:if(s.committed){t.next=38;break}throw J(!1),new Error("New Message Transaction Aborted!");case 38:return ie(!1),t.next=41,c.child(e.currentUser.uid).set(!1);case 41:document.getElementById("msg-input").value="",console.log("Message sent!"),J(!1);case 44:t.next=50;break;case 46:t.prev=46,t.t0=t.catch(1),console.error("ERROR: "+t.t0.message),alert(t.t0.message);case 50:case"end":return t.stop()}}),t,null,[[1,46]])})));return function(e){return t.apply(this,arguments)}}(),Oe=function(e){var t=e.target.innerHTML;console.log(t);var n=document.querySelector(".chatroom .chat-container .input-container #msg-input"),r=n.value.substring(0,n.selectionStart),a=n.value.substring(n.selectionEnd,n.value.length);0===n.selectionStart&&0===n.selectionEnd&&(r=n.value,a=""),n.value=r+t+a,n.focus(),n.setSelectionRange(r.length+1,r.length+1)},ke=function(){ee(!$),document.querySelector(".chatroom").classList.toggle("queue-opened")},we=function(e){var t=parseFloat(getComputedStyle(document.documentElement).fontSize),n=document.querySelector(".chatroom .chat-container .special-char-container"),r="material-icons"===e.target.className?"arrow_back_ios"===e.target.innerHTML?"back-arrow":"forward-arrow":e.target.className;"back-arrow"===r?n.scrollBy(-(1.3*t+12),0):"forward-arrow"===r&&n.scrollBy(1.3*t+12,0)},Se=function(e){var t=new Date(e),n=t.getHours()<10?"0"+t.getHours().toString():t.getHours().toString(),r=t.getMinutes()<10?"0"+t.getMinutes().toString():t.getMinutes().toString(),a=t.getMonth()<9?"0"+(t.getMonth()+1).toString():(t.getMonth()+1).toString();return n+":"+r+", "+(t.getDate()<10?"0"+t.getDate().toString():t.getDate().toString())+"/"+a};return Object(r.useEffect)((function(){return console.log("Chatroom mounted!"),je(),function(){console.log("Chatroom Unmounted!");var e=sessionStorage.getItem("heartlinehk-currentClient");n.orderByChild("time").off("value"),o.orderByChild("time").off("value"),e&&(s.child(e).off("value"),c.child(e).off("value"),sessionStorage.removeItem("heartlinehk-currentClient"))}}),[]),Object(r.useEffect)((function(){T.length>0&&v.current.scrollTo(0,v.current.scrollHeight)}),[T]),Object(b.jsxs)("div",{className:"chatroom",children:[Object(b.jsx)(h,{modalId:"endchat-modal",confirmText:"\u4f60\u78ba\u5b9a\u8981\u7d50\u675f\u5c0d\u8a71\u55ce\uff1f",formSubmitHandler:function(e){e.preventDefault();var t=e.target.parentElement.parentElement;"endchat-modal"===t.id?("confirm-btn"===e.target.className&&pe(),t.classList.remove("opened")):console.error("ERROR: Parent Element is not an end chat modal!")}}),Object(b.jsx)(h,{modalId:"startchat-modal",confirmText:"\u4f60\u78ba\u5b9a\u8981\u958b\u555f\u65b0\u5c0d\u8a71\u55ce\uff1f",formSubmitHandler:function(e){e.preventDefault();var t=e.target.parentElement.parentElement;"startchat-modal"===t.id?("confirm-btn"===e.target.className&&(ke(),ve()),t.classList.remove("opened")):console.error("ERROR: Parent Element is not a start chat modal!")}}),(P||G)&&Object(b.jsx)(x,{}),Object(b.jsxs)("div",{className:"chat-container",children:[null!=H&&Object(b.jsxs)("p",{className:"disconnect-msg",children:["\u4f7f\u7528\u8005\u5df2\u65bc",Se(H),"\u958b\u59cb\u96e2\u7dda\u3002"]}),Object(b.jsx)("div",{ref:v,className:"messages-container",children:T.map((function(n,r){return Object(b.jsxs)("p",{className:"message "+(n.spc?"special":n.uid===e.currentUser.uid?"right":"left"),children:[n.msg?n.msg:t[n.spc]?t[n.spc]:t.clientId,Object(b.jsx)("span",{children:Se(n.time)})]},n.chatId)}))}),Object(b.jsxs)("div",{className:"special-char-container",children:[Object(b.jsx)("button",{className:"back-arrow",onClick:we,children:Object(b.jsx)("span",{className:"material-icons",children:"arrow_back_ios"})}),["\u5572","\u5481","\u55f0","\u5497","\u55ba","\u4fc2","\u54cb","\u5514","\u54a9","\u54aa","\u5605","\u35ce","\u558e","\u5622","\u569f","\u56c9","\u4e5c","\u53fb","\u5462","\u5571","\u7747","\u8ad7","\u564f","\u5625","\u6652","\u548b","\u7793","\u551e","\u6c39","\u6530","\u4ffe","\u9582","\u5440","\u5566","\u51a7","\u664f","\u5b32","\u5587"].map((function(e,t){return Object(b.jsx)("button",{className:"spc-char",onClick:Oe,children:e},"spc-char"+t)})),Object(b.jsx)("button",{className:"forward-arrow",onClick:we,children:Object(b.jsx)("span",{className:"material-icons",children:"arrow_forward_ios"})})]}),Object(b.jsxs)("form",{className:"input-container",onSubmit:xe,children:[re&&Object(b.jsx)("p",{className:"typing-msg",children:"\u4f7f\u7528\u8005\u6b63\u5728\u8f38\u5165..."}),Object(b.jsx)("button",{type:"button",name:"emoji-btn",id:"emoji-btn",onClick:function(){me(!de)},children:Object(b.jsx)("span",{className:"material-icons",children:"emoji_emotions"})}),Object(b.jsx)("input",{type:"text",name:"msg-input",id:"msg-input",placeholder:"\u6309\u6b64\u5c0d\u8a71\u2026",onInput:function(t){if(C){var n=""!=t.target.value;n!=oe&&(c?(ie(n),c.child(e.currentUser.uid).set(n)):console.error("ERROR: Typing Status reference not available!"))}}}),Object(b.jsx)("button",{type:"submit",name:"submit-btn",id:"submit-btn",children:Object(b.jsx)("span",{className:"material-icons",children:"send"})})]}),de&&Object(b.jsx)(k.a,{onEmojiClick:function(e,t){console.log(t.emoji);var n=document.querySelector(".chatroom .chat-container .input-container #msg-input"),r=n.value.substring(0,n.selectionStart),a=n.value.substring(n.selectionEnd,n.value.length);0===n.selectionStart&&0===n.selectionEnd&&(r=n.value,a=""),n.value=r+t.emoji+a,n.focus(),n.setSelectionRange(r.length+2,r.length+2)}})]}),Object(b.jsxs)("div",{className:"queue-container",children:[Object(b.jsxs)("p",{className:"main-text",children:[Object(b.jsx)("span",{className:"material-icons",children:"people"}),Object(b.jsx)("span",{className:"queue-count",children:y.length})]}),Object(b.jsx)("div",{ref:p,className:"clients-container",children:y.map((function(e,t){return Object(b.jsxs)("p",{className:"queue-client"+("roomAssigned"===e.status?" assigned":""),children:["Client ",Object(b.jsx)("span",{className:"client-id",children:e.userId}),Object(b.jsxs)("span",{className:"enqueue-time","data-time":e.time,children:["roomAssigned"===e.status?"\u88ab\u63a5\u6536":"\u5165\u968a","\u6642\u9593: ",Se(e.time)]})]},e.userId)}))}),Object(b.jsxs)("div",{className:"buttons-container",children:[Object(b.jsx)("button",{type:"submit",name:"start-btn",id:"start-btn",disabled:null!=C||y.length<=0,onClick:function(){document.getElementById("startchat-modal").classList.add("opened")},children:"\u958b\u59cb\u5c0d\u8a71"}),Object(b.jsx)("button",{type:"submit",name:"end-btn",id:"end-btn",disabled:null==C,onClick:function(){document.getElementById("endchat-modal").classList.add("opened")},children:"\u7d50\u675f\u5c0d\u8a71"})]})]}),Object(b.jsx)("button",{className:"queue-toggle",onClick:ke,children:Object(b.jsx)("span",{className:"material-icons",children:$?"chat":"contacts"})})]})},y=(n(52),function(){return Object(b.jsx)("div",{className:"dashboard",children:Object(b.jsx)("h1",{children:"WORK IN PROGRESS"})})}),N=(n(53),function(e){return Object(b.jsxs)("div",{className:"login",children:[Object(b.jsx)("h1",{className:"main-text",children:"HeartlineHK Login"}),Object(b.jsxs)("form",{className:"login-form",onSubmit:e.handleLogin,children:[Object(b.jsx)("label",{htmlFor:"login-email",children:"Email:"}),Object(b.jsx)("input",{type:"email",name:"login-email",id:"login-email",required:!0}),Object(b.jsx)("label",{htmlFor:"login-pwd",children:"Password:"}),Object(b.jsx)("input",{type:"password",name:"login-password",id:"login-password",required:!0}),Object(b.jsx)("input",{type:"submit",value:"Login",name:"login-submit",id:"login-submit"})]})]})});var E=function(){g.a.database().ref("online_time");var e=Object(r.useState)(null),t=Object(u.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(!1),c=Object(u.a)(s,2),o=c[0],f=c[1],x=Object(r.useState)(g.a.auth()),O=Object(u.a)(x,2),k=O[0],w=(O[1],function(){var e=Object(l.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),o){e.next=20;break}return f(!0),n=document.getElementById("login-email").value,r=document.getElementById("login-password").value,e.prev=5,e.next=8,k.setPersistence(g.a.auth.Auth.Persistence.SESSION);case 8:return e.next=10,k.signInWithEmailAndPassword(n,r);case 10:console.log(k.currentUser),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),console.error(e.t0.message),alert(e.t0.message);case 17:f(!1),e.next=22;break;case 20:console.error("Already logging in"),alert("Already logging in!");case 22:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()),E=function(){var e=Object(l.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.signOut();case 3:console.log("Signed out!"),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0.message),alert(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){return g.a.auth().onAuthStateChanged((function(e){a(e||null)}))})),Object(b.jsx)(d.a,{children:Object(b.jsxs)("div",{className:"App",style:{width:"100vw",minHeight:"100vh",position:"relative",backgroundColor:"rgba(0,0,0,0.05)",display:"flex",flexDirection:"row",overflow:"hidden"},children:[!n&&Object(b.jsx)(N,{handleLogin:w}),n&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(h,{modalId:"logout-modal",confirmText:"\u4f60\u78ba\u5b9a\u8981\u767b\u51fa\u55ce\uff1f",formSubmitHandler:function(e){e.preventDefault();var t=e.target.parentElement.parentElement;"logout-modal"===t.id?("confirm-btn"===e.target.className&&E(),t.classList.remove("opened")):console.error("ERROR: Parent Element is not a logout modal!")}}),Object(b.jsx)(j,{currentUser:n,handleLogout:function(){document.getElementById("logout-modal").classList.add("opened")}}),Object(b.jsxs)(m.c,{children:[Object(b.jsx)(m.a,{exact:!0,path:"/chatroom",children:Object(b.jsx)(S,{currentUser:n})}),Object(b.jsx)(m.a,{exact:!0,path:"/supervisor",children:Object(b.jsx)(p,{currentUser:n})}),Object(b.jsx)(m.a,{exact:!0,path:"/profile-update",children:Object(b.jsx)(v,{currentUser:n})}),Object(b.jsx)(m.a,{path:"/",children:Object(b.jsx)(y,{currentUser:n})})]})]})]})})};g.a.initializeApp({apiKey:"AIzaSyD-gB_LHwUq2qiUXdDt2CAxGCYQQla4hMo",authDomain:"heartlinehk-8e3ec.firebaseapp.com",databaseURL:"https://heartlinehk-8e3ec-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"heartlinehk-8e3ec",storageBucket:"heartlinehk-8e3ec.appspot.com",messagingSenderId:"1077537941035",appId:"1:1077537941035:web:f5b566fde9a2363a2d6c6e",measurementId:"G-S9JD41562T"}),c.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(E,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.644956d0.chunk.js.map