(this["webpackJsonpheartlinehk-admin"]=this["webpackJsonpheartlinehk-admin"]||[]).push([[0],{35:function(e,t,n){},37:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){},55:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),s=n(28),o=n.n(s),c=(n(35),n(6)),i=n.n(c),l=n(12),u=n(7),d=n(16),m=n(8),h=(n(37),n(1)),b=function(e){return Object(h.jsx)("div",{id:e.modalId?e.modalId:"default-modal",className:"modal-container",children:Object(h.jsxs)("form",{className:"confirm-modal",children:[Object(h.jsx)("p",{className:"confirm-text",children:e.confirmText?e.confirmText:"Changes might be lost if you leave now. Confirm?"}),Object(h.jsx)("button",{type:"submit",name:"confirm-btn",className:"confirm-btn",onClick:e.formSubmitHandler,children:"\u78ba\u5b9a"}),Object(h.jsx)("button",{type:"submit",name:"cancel-btn",className:"cancel-btn",onClick:e.formSubmitHandler,children:"\u53d6\u6d88"})]})})},f=(n(39),function(e){return Object(h.jsx)("div",{id:e.modalId?e.modalId:"default-modal",className:"modal-container",children:Object(h.jsxs)("form",{className:"notice-modal",children:[Object(h.jsx)("p",{className:"notice-text",children:e.noticeText?e.noticeText:"Default Text for Notice Modal."}),Object(h.jsx)("button",{type:"submit",name:"confirm-btn",className:"confirm-btn",onClick:e.formSubmitHandler,children:"\u78ba\u5b9a"})]})})}),g=n.p+"static/media/logo_80x80.6314ce1a.png",v=(n(40),n(5)),j=(n(18),n(19),function(e){var t=Object(r.useRef)(),n=Object(r.useRef)(),a=Object(r.useState)(!1),s=Object(u.a)(a,2),o=s[0],c=s[1],i=function(){t.current.style.transitionDuration="0.5s",t.current.classList.remove("opened"),n.current.classList.remove("opened")};return Object(r.useEffect)((function(){v.a.database().ref("supervisors").child(e.currentUser.uid).once("value",(function(e){null!=e.val()?c(!0):c(!1)}))}),[]),Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("button",{className:"nav-toggle-btn",onClick:function(){t.current.style.transitionDuration="0.5s",t.current.classList.add("opened"),n.current.classList.add("opened")},children:Object(h.jsx)("span",{className:"material-icons",children:"menu"})}),Object(h.jsxs)("nav",{className:"nav-container",ref:t,children:[Object(h.jsxs)("a",{href:"#",className:"nav-logo",children:[Object(h.jsx)("img",{src:g,alt:g,className:"front"}),Object(h.jsx)("p",{className:"nav-name",children:"HEARTLINEHK"})]}),Object(h.jsxs)("ul",{className:"nav-items-container",children:[Object(h.jsx)("li",{className:"nav-item",children:Object(h.jsxs)(d.b,{to:"/",className:"nav-link",onClick:i,children:[Object(h.jsx)("span",{className:"material-icons",children:"home"})," \u8cc7\u8a0a\u7248\u9762"]})}),Object(h.jsx)("li",{className:"nav-item",children:Object(h.jsxs)(d.b,{to:"/chatroom",className:"nav-link",onClick:i,children:[Object(h.jsx)("span",{className:"material-icons",children:"chat"})," \u804a\u5929\u5ba4"]})}),Object(h.jsx)("li",{className:"nav-item",children:Object(h.jsxs)(d.b,{to:"/profile-update",className:"nav-link",onClick:i,children:[Object(h.jsx)("span",{className:"material-icons",children:"badge"})," \u66f4\u6539\u500b\u4eba\u8cc7\u6599"]})}),o&&Object(h.jsx)("li",{className:"nav-item",children:Object(h.jsxs)(d.b,{to:"/supervisor",className:"nav-link",onClick:i,children:[Object(h.jsx)("span",{className:"material-icons",children:"question_answer"})," \u7ba1\u7406\u54e1\u7248\u9762"]})})]}),Object(h.jsxs)("div",{className:"nav-user",onClick:e.handleLogout,children:[Object(h.jsx)("img",{src:"https://t4.ftcdn.net/jpg/02/34/61/79/360_F_234617921_p1AGQkGyEl8CSzwuUI74ljn6IZXqMUf2.jpg",alt:""}),Object(h.jsx)("a",{className:"username",children:e.currentUser.displayName})]})]}),Object(h.jsx)("div",{ref:n,className:"nav-background",onClick:i})]})}),p=(n(49),function(e){var t=Object(r.useRef)(),n=function(){var n=Object(l.a)(i.a.mark((function n(r){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.preventDefault(),n.prev=1,!e.currentUser){n.next=14;break}if(""==(a=t.current.value)){n.next=11;break}return n.next=7,e.currentUser.updateProfile({displayName:a});case 7:t.current.value="",alert("Profile Update Successful!"),n.next=12;break;case 11:throw new Error("New Display Name is null!");case 12:n.next=15;break;case 14:throw new Error("Current User is null!");case 15:n.next=21;break;case 17:n.prev=17,n.t0=n.catch(1),console.error("ERROR: "+n.t0.message),alert(n.t0.message);case 21:case"end":return n.stop()}}),n,null,[[1,17]])})));return function(e){return n.apply(this,arguments)}}();return Object(h.jsx)("div",{className:"profile-update",children:Object(h.jsxs)("form",{className:"update-form",onSubmit:n,children:[Object(h.jsx)("label",{htmlFor:"display-name-input",children:"\u65b0\u986f\u793a\u540d\u7a31"}),Object(h.jsx)("input",{ref:t,type:"text",name:"display-name-input",id:"display-name-input"}),Object(h.jsx)("button",{type:"submit",children:"\u66f4\u6539\u8cc7\u6599"})]})})}),x=(n(50),function(e){var t={clientLeft:"\u4f7f\u7528\u8005\u5df2\u96e2\u958b\u804a\u5929\u5ba4",volunLeft:"\u7fa9\u5de5\u5df2\u96e2\u958b\u804a\u5929\u5ba4",clientId:"\u7fa9\u5de5\u5df2\u958b\u555f\u804a\u5929\u5ba4",noChatStarted:"\u6b64\u7fa9\u5de5\u672a\u6709\u958b\u555f\u804a\u5929\u5ba4"},n=v.a.database().ref("online_time"),a=v.a.database().ref("room_assigned"),s=v.a.database().ref("disconnect_time"),o=v.a.database().ref("chat_log"),c=Object(r.useRef)(null),d=Object(r.useState)(null),m=Object(u.a)(d,2),b=m[0],f=m[1],g=Object(r.useState)([]),j=Object(u.a)(g,2),p=j[0],x=j[1],O=Object(r.useState)([]),k=Object(u.a)(O,2),w=k[0],S=k[1],E=Object(r.useState)(!1),y=Object(u.a)(E,2),N=(y[0],y[1]),R=function(e){var t=[];if(console.log(e.val()),null!=e.val())for(var n in e.val())t.push({chatId:n,uid:e.val()[n].uid,time:e.val()[n].time,msg:e.val()[n].msg,spc:e.val()[n].spc});console.log(t),S(t)},C=function(e){var t=[];if(null!=e.val())for(var n in e.val())t.push(n);console.log(t),x(t)},I=function(e){f(e.val())},M=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,r,c,l,u,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.innerHTML,r=null,e.next=4,a.once("value");case 4:c=e.sent.val(),e.t0=i.a.keys(c);case 6:if((e.t1=e.t0()).done){e.next=13;break}if(l=e.t1.value,c[l]!==n){e.next=11;break}return r=l,e.abrupt("break",13);case 11:e.next=6;break;case 13:console.log(n),console.log(r),u=sessionStorage.getItem("heartlinehk-supervisor-currentVolun"),d=sessionStorage.getItem("heartlinehk-supervisor-currentClient"),u&&o.child(u).orderByChild("time").off("value"),d&&s.child(d).off("value"),sessionStorage.setItem("heartlinehk-supervisor-currentVolun",n),sessionStorage.setItem("heartlinehk-supervisor-currentClient",r),null!=r?(o.child(n).orderByChild("time").on("value",R),s.child(r).on("value",I)):S([{chatId:"nochatstarted",uid:n,time:Date.now(),spc:"noChatStarted"}]);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(e){var t=new Date(e),n=t.getHours()<10?"0"+t.getHours().toString():t.getHours().toString(),r=t.getMinutes()<10?"0"+t.getMinutes().toString():t.getMinutes().toString(),a=t.getMonth()<9?"0"+(t.getMonth()+1).toString():(t.getMonth()+1).toString();return n+":"+r+", "+(t.getDate()<10?"0"+t.getDate().toString():t.getDate().toString())+"/"+a};return Object(r.useEffect)((function(){return v.a.database().ref("supervisors").child(e.currentUser.uid).once("value",(function(e){null!=e.val()?N(!0):N(!1)})),n.on("value",C),function(){console.log("Supervisor Unmounted!"),n.off("value");var e=sessionStorage.getItem("heartlinehk-supervisor-currentVolun"),t=sessionStorage.getItem("heartlinehk-supervisor-currentClient");e&&(o.child(e).orderByChild("time").off("value"),sessionStorage.removeItem("heartlinehk-supervisor-currentVolun")),t&&(s.child(t).off("value"),sessionStorage.removeItem("heartlinehk-supervisor-currentClient"))}}),[]),Object(r.useEffect)((function(){w.length>0&&c.current.scrollTo(0,c.current.scrollHeight)}),[w]),Object(h.jsxs)("div",{className:"supervisor",children:[Object(h.jsx)("div",{className:"volunteers-container",children:p.map((function(e,t){var n=sessionStorage.getItem("heartlinehk-supervisor-currentVolun");return Object(h.jsx)("button",{className:"volun-btn"+(n===e?" selected":""),value:e,onClick:M,children:e},"online-volun-"+t)}))}),null!=b&&Object(h.jsxs)("p",{className:"disconnect-msg",children:["\u4f7f\u7528\u8005\u5df2\u65bc",U(b),"\u958b\u59cb\u96e2\u7dda\u3002"]}),Object(h.jsx)("div",{ref:c,className:"chat-container",children:w.length>0&&w.map((function(e,n){var r=sessionStorage.getItem("heartlinehk-supervisor-currentVolun");return Object(h.jsxs)("p",{className:"message "+(e.spc?"special":e.uid===r?"right":"left"),children:[e.msg?e.msg:t[e.spc]?t[e.spc]:t.clientId,Object(h.jsx)("span",{children:U(e.time)})]},e.chatId)}))})]})}),O=(n(51),function(){return Object(h.jsx)("div",{className:"loading",children:Object(h.jsx)("div",{className:"spinning-circle"})})}),k=n(30),w=n.n(k),S=(n(52),n.p+"static/media/pristine-609.9287f5ce.mp3"),E=function(e){var t={clientLeft:"\u4f7f\u7528\u8005\u5df2\u96e2\u958b\u804a\u5929\u5ba4",volunLeft:"\u7fa9\u5de5\u5df2\u96e2\u958b\u804a\u5929\u5ba4",clientId:"\u7fa9\u5de5\u5df2\u958b\u555f\u804a\u5929\u5ba4"},n=v.a.database().ref("chat_records"),a=v.a.database().ref("chat_queue"),s=v.a.database().ref("room_assigned"),o=v.a.database().ref("disconnect_time"),c=v.a.database().ref("typing_status"),d=v.a.database().ref("chat_log/".concat(e.currentUser.uid)),m="https://docs.google.com/forms/d/e/1FAIpQLSdsD_qLU51OC9UY0Rrx_Ht52aU0TgPU-LUu5yNp4ta8cYu0yQ/viewform?usp=pp_url",f="entry.1533999842",g="entry.240218030",j="entry.1133078412",p=Object(r.useRef)(null),x=Object(r.useRef)(null),k=Object(r.useState)([]),E=Object(u.a)(k,2),y=E[0],N=E[1],R=Object(r.useState)(null),C=Object(u.a)(R,2),I=C[0],M=C[1],U=Object(r.useState)(null),D=Object(u.a)(U,2),H=D[0],T=D[1],L=Object(r.useState)([]),A=Object(u.a)(L,2),_=A[0],q=A[1],B=Object(r.useState)(!1),P=Object(u.a)(B,2),F=P[0],Q=P[1],V=Object(r.useState)(!1),z=Object(u.a)(V,2),G=z[0],Y=z[1],K=Object(r.useState)(!1),W=Object(u.a)(K,2),J=W[0],X=W[1],Z=Object(r.useState)(!1),$=Object(u.a)(Z,2),ee=$[0],te=$[1],ne=Object(r.useState)(!1),re=Object(u.a)(ne,2),ae=re[0],se=re[1],oe=Object(r.useState)(!1),ce=Object(u.a)(oe,2),ie=ce[0],le=ce[1],ue=Object(r.useState)(!1),de=Object(u.a)(ue,2),me=de[0],he=de[1],be=function(e){var t=[];if(console.log(e.val()),null!=e.val())for(var n in e.val())t.push({chatId:n,uid:e.val()[n].uid,time:e.val()[n].time,msg:e.val()[n].msg,spc:e.val()[n].spc});console.log(t),q(t)},fe=function(e){var t=[],n=!1,r=document.querySelectorAll(".chatroom .queue-container .clients-container .queue-client .client-id");if(console.log(e.val()),null!=e.val()){var a=function(a){if(t.push({userId:a,status:e.val()[a].status,time:e.val()[a].time}),!n){var s=!1;r.forEach((function(e){e.innerHTML===a&&(s=!0)})),n=!s}};for(var s in e.val())a(s);for(var o=0;o<t.length;o++)for(var c=0;c<t.length-o-1;c++)if(t[c].time>t[c+1].time){var i=t[c];t[c]=t[c+1],t[c+1]=i}}n&&new Audio(S).play();console.log(t),N(t)},ge=function(e){T(e.val())},ve=function(e){se(e.val())},je=function(){var t=Object(l.a)(i.a.mark((function t(){var n,r,l;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a.orderByChild("time").on("value",fe),d.orderByChild("time").on("value",be),n=sessionStorage.getItem("heartlinehk-currentClient"),t.next=6,s.once("value");case 6:r=t.sent,t.t0=i.a.keys(r.val());case 8:if((t.t1=t.t0()).done){t.next=16;break}if(l=t.t1.value,r.val()[l]!==e.currentUser.uid){t.next=14;break}return null!==n&&n!==l&&console.warn("WARNING: updating local current client as it is different from database!"),n=l,t.abrupt("break",16);case 14:t.next=8;break;case 16:null!=n?(o.child(n).on("value",ge),c.child(n).on("value",ve),M(n),sessionStorage.setItem("heartlinehk-currentClient",n)):console.warn("WARNING: No client is assigned to the current volunteer!"),t.next=22;break;case 19:t.prev=19,t.t2=t.catch(0),console.error("ERROR: "+t.t2.message);case 22:case"end":return t.stop()}}),t,null,[[0,19]])})));return function(){return t.apply(this,arguments)}}(),pe=function(){var t=Object(l.a)(i.a.mark((function t(n){var r,l,u,m,h,b,f,g,j,p,x,O,k,w,S,E;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=0,l=null,u=null,t.prev=3,!F){t.next=6;break}throw new Error("Already starting a new chat!");case 6:if(Q(!0),a){t.next=12;break}throw Q(!1),new ReferenceError("Chat Queue reference not available!");case 12:if(s){t.next=17;break}throw Q(!1),new ReferenceError("Room Assigned reference not available!");case 17:if(d){t.next=22;break}throw Q(!1),new ReferenceError("Chat Room reference not available!");case 22:if(o){t.next=27;break}throw Q(!1),new ReferenceError("Disconnect Time reference not available!");case 27:if(c){t.next=32;break}throw Q(!1),new ReferenceError("Typing Status reference not available!");case 32:if(null==I){t.next=37;break}throw Q(!1),new Error("CurrentClient is already set!");case 37:return t.next=39,a.orderByChild("time").once("value");case 39:if(m=t.sent,h=[],null!=m.val()){for(b in m.val())h.push({userId:b,status:m.val()[b].status,time:m.val()[b].time});for(f=0;f<h.length;f++)for(g=0;g<h.length-f-1;g++)h[g].time>h[g+1].time&&(j=h[g],h[g]=h[g+1],h[g+1]=j)}t.t0=i.a.keys(h);case 43:if((t.t1=t.t0()).done){t.next=51;break}if(p=t.t1.value,"inQueue"!==h[p].status){t.next=49;break}return l=h[p].userId,u=h[p].time,t.abrupt("break",51);case 49:t.next=43;break;case 51:if(null!==l){t.next=54;break}throw Q(!1),new RangeError("No available client in chat queue!");case 54:return x=a.child(l),t.next=57,x.transaction((function(e){return null===e?void console.error("ERROR: Required Queue Client is Null!"):"roomAssigned"===e.status?void console.error("ERROR: Required Queue Client has already assigned a room!"):"inQueue"===e.status?{status:"roomAssigned",time:v.a.database.ServerValue.TIMESTAMP}:void console.error("Unknown Error!")}));case 57:if(!(O=t.sent).error){t.next=63;break}throw Q(!1),new Error(O.error);case 63:if(O.committed){t.next=66;break}throw Q(!1),new Error("Client Queue Transaction Aborted!");case 66:return r+=1,k=s.child(l),t.next=70,k.transaction((function(t){return null===t?e.currentUser.uid:void console.error("ERROR: Client to be assigned has a non-null volunteer ID!")}));case 70:if(!(w=t.sent).error){t.next=76;break}throw Q(!1),new Error(w.error);case 76:if(w.committed){t.next=79;break}throw Q(!1),new Error("Client Room Assigned Transaction Aborted!");case 79:return r+=1,t.next=82,d.once("value");case 82:if(null==t.sent.val()){t.next=86;break}return t.next=86,d.remove();case 86:return r+=1,t.next=89,d.push();case 89:return S=t.sent,t.next=92,S.transaction((function(t){return null===t?{uid:e.currentUser.uid,time:v.a.database.ServerValue.TIMESTAMP,spc:l}:void console.error("ERROR: Initial Message is not null!")}));case 92:if(!(E=t.sent).error){t.next=98;break}throw Q(!1),new Error(E.error);case 98:if(E.committed){t.next=101;break}throw Q(!1),new Error("Initial Message Transaction Aborted!");case 101:r+=1,sessionStorage.setItem("heartlinehk-currentClient",l),M(l),o.child(l).on("value",ge),c.child(l).on("value",ve),Q(!1);case 107:t.next=120;break;case 109:if(t.prev=109,t.t2=t.catch(3),console.error("ERROR: "+t.t2.message),!(r>=1)){t.next=115;break}return t.next=115,a.child(l).set({status:"inQueue",time:u});case 115:if(!(r>=2)){t.next=118;break}return t.next=118,s.child(l).remove();case 118:r>=4&&(sessionStorage.setItem("heartlinehk-currentClient",l),M(l),Q(!1)),alert(t.t2.message);case 120:case"end":return t.stop()}}),t,null,[[3,109]])})));return function(e){return t.apply(this,arguments)}}(),xe=function(){var t=Object(l.a)(i.a.mark((function t(){var r,l,u,h,b,v,p,x,O,k,w,S,E,y,N,R,C,U,D,H,L,A,_,B,P,F,Q,V,z,K,W,J;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=0,l=!1,u=0,h=0,t.prev=4,!G){t.next=7;break}throw new Error("Already ending a chat!");case 7:if(Y(!0),s){t.next=13;break}throw Y(!1),new ReferenceError("Room Assigned reference not available!");case 13:if(d){t.next=18;break}throw Y(!1),new ReferenceError("Chat Room reference not available!");case 18:if(o){t.next=23;break}throw Y(!1),new ReferenceError("Disconnect Time reference not available!");case 23:if(c){t.next=28;break}throw Y(!1),new ReferenceError("Typing Status reference not available!");case 28:if(n){t.next=33;break}throw Y(!1),new ReferenceError("Chat Records reference not available!");case 33:if(null!=I){t.next=38;break}throw Y(!1),new Error("Current Client is null!");case 38:return t.next=40,s.child(I).once("value");case 40:return b=t.sent,v=null===b.val(),t.next=44,d.once("value");case 44:if(p=t.sent.val(),x=!1,null==p){t.next=55;break}t.t0=i.a.keys(p);case 48:if((t.t1=t.t0()).done){t.next=55;break}if(O=t.t1.value,"clientLeft"!==p[O].spc){t.next=53;break}return x=!0,t.abrupt("break",55);case 53:t.next=48;break;case 55:return t.next=57,a.child(I).once("value");case 57:if(t.t2=t.sent.val(),k=null!=t.t2,console.log(v,x,k),r+=1,l=v||x){t.next=69;break}if(v){t.next=66;break}return t.next=66,s.child(I).set("volunLeft");case 66:if(!k){t.next=69;break}return t.next=69,a.child(I).remove();case 69:return r+=1,t.next=72,d.orderByChild("time").limitToFirst(1).once("value");case 72:for(S in w=t.sent.val())u=w[S].time;return h=Date.now(),t.next=77,d.transaction((function(e){return null!=e?null:void console.error("ERROR: Chat Log in Chatroom already null!")}));case 77:if(!(E=t.sent).error){t.next=83;break}throw Y(!1),new Error(E.error);case 83:if(E.committed){t.next=86;break}throw Y(!1),new Error("Chatrom Transaction Aborted!");case 86:return q([]),r+=1,t.next=90,n.push();case 90:return y=t.sent,t.next=93,y.set({uid:e.currentUser.uid,start:u,end:h});case 93:return t.next=95,c.child(e.currentUser.uid).remove();case 95:o.child(I).off("value"),T(null),c.child(I).off("value"),se(!1),sessionStorage.removeItem("heartlinehk-currentClient"),M(null),Y(!1),N=new Date(u),R=N.getHours()<10?"0"+N.getHours().toString():N.getHours().toString(),C=N.getMinutes()<10?"0"+N.getMinutes().toString():N.getMinutes().toString(),U=new Date(h),D=U.getHours()<10?"0"+U.getHours().toString():U.getHours().toString(),H=U.getMinutes()<10?"0"+U.getMinutes().toString():U.getMinutes().toString(),L=U.getMonth()+1<10?"0"+(U.getMonth()+1).toString():(U.getMonth()+1).toString(),A=U.getDate()<10?"0"+U.getDate().toString():U.getDate().toString(),_=m+"&"+f+"="+U.getFullYear()+"-"+L+"-"+A+"&"+g+"="+R+":"+C+"&"+j+"="+D+":"+H,window.open(_,"ChatRecordForm","resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no,status=yes");case 112:t.next=123;break;case 114:if(t.prev=114,t.t3=t.catch(4),console.error("ERROR: "+t.t3.message),!(r>=2)){t.next=121;break}if(l){t.next=121;break}return t.next=121,s.child(I).set(e.currentUser.uid);case 121:r>=3&&(o.child(I).off("value"),T(null),c.child(I).off("value"),se(!1),sessionStorage.removeItem("heartlinehk-currentClient"),M(null),B=new Date(u),P=B.getHours()<10?"0"+B.getHours().toString():B.getHours().toString(),F=B.getMinutes()<10?"0"+B.getMinutes().toString():B.getMinutes().toString(),Q=new Date(h),V=Q.getHours()<10?"0"+Q.getHours().toString():Q.getHours().toString(),z=Q.getMinutes()<10?"0"+Q.getMinutes().toString():Q.getMinutes().toString(),K=Q.getMonth()+1<10?"0"+(Q.getMonth()+1).toString():(Q.getMonth()+1).toString(),W=Q.getDate()<10?"0"+Q.getDate().toString():Q.getDate().toString(),J=m+"&"+f+"="+Q.getFullYear()+"-"+K+"-"+W+"&"+g+"="+P+":"+F+"&"+j+"="+V+":"+z,window.open(J,"ChatRecordForm","resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no,status=yes")),alert(t.t3.message);case 123:case"end":return t.stop()}}),t,null,[[4,114]])})));return function(){return t.apply(this,arguments)}}(),Oe=function(){var t=Object(l.a)(i.a.mark((function t(n){var r,a,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),t.prev=1,!J){t.next=4;break}throw new Error("Already sending a message!");case 4:if(X(!0),null!==I){t.next=8;break}throw X(!1),new Error("Current Client is null!");case 8:if(null!==(r=document.getElementById("msg-input").value)&&""!==r){t.next=14;break}throw X(!1),new Error("Message to be sent is empty!");case 14:if(d){t.next=19;break}throw X(!1),new ReferenceError("Chatroom reference not available!");case 19:if(c){t.next=24;break}throw X(!1),new ReferenceError("Typing Status reference not available!");case 24:return t.next=26,d.push();case 26:return a=t.sent,t.next=29,a.transaction((function(t){return null===t?{uid:e.currentUser.uid,time:v.a.database.ServerValue.TIMESTAMP,msg:r}:void console.error("ERROR: New Message is not null!")}));case 29:if(!(s=t.sent).error){t.next=35;break}throw X(!1),new Error(s.error);case 35:if(s.committed){t.next=38;break}throw X(!1),new Error("New Message Transaction Aborted!");case 38:return le(!1),t.next=41,c.child(e.currentUser.uid).set(!1);case 41:document.getElementById("msg-input").value="",console.log("Message sent!"),X(!1);case 44:t.next=50;break;case 46:t.prev=46,t.t0=t.catch(1),console.error("ERROR: "+t.t0.message),alert(t.t0.message);case 50:case"end":return t.stop()}}),t,null,[[1,46]])})));return function(e){return t.apply(this,arguments)}}(),ke=function(e){var t=e.target.innerHTML;console.log(t);var n=document.querySelector(".chatroom .chat-container .input-container #msg-input"),r=n.value.substring(0,n.selectionStart),a=n.value.substring(n.selectionEnd,n.value.length);0===n.selectionStart&&0===n.selectionEnd&&(r=n.value,a=""),n.value=r+t+a,n.focus(),n.setSelectionRange(r.length+1,r.length+1)},we=function(){te(!ee),document.querySelector(".chatroom").classList.toggle("queue-opened")},Se=function(e){var t=parseFloat(getComputedStyle(document.documentElement).fontSize),n=document.querySelector(".chatroom .chat-container .special-char-container"),r="material-icons"===e.target.className?"arrow_back_ios"===e.target.innerHTML?"back-arrow":"forward-arrow":e.target.className;"back-arrow"===r?n.scrollBy(-(1.3*t+12),0):"forward-arrow"===r&&n.scrollBy(1.3*t+12,0)},Ee=function(e){var t=new Date(e),n=t.getHours()<10?"0"+t.getHours().toString():t.getHours().toString(),r=t.getMinutes()<10?"0"+t.getMinutes().toString():t.getMinutes().toString(),a=t.getMonth()<9?"0"+(t.getMonth()+1).toString():(t.getMonth()+1).toString();return n+":"+r+", "+(t.getDate()<10?"0"+t.getDate().toString():t.getDate().toString())+"/"+a};return Object(r.useEffect)((function(){return console.log("Chatroom mounted!"),je(),function(){console.log("Chatroom Unmounted!");var e=sessionStorage.getItem("heartlinehk-currentClient");a.orderByChild("time").off("value"),d.orderByChild("time").off("value"),e&&(o.child(e).off("value"),c.child(e).off("value"),sessionStorage.removeItem("heartlinehk-currentClient"))}}),[]),Object(r.useEffect)((function(){_.length>0&&p.current.scrollTo(0,p.current.scrollHeight)}),[_]),Object(h.jsxs)("div",{className:"chatroom",children:[Object(h.jsx)(b,{modalId:"endchat-modal",confirmText:"\u4f60\u78ba\u5b9a\u8981\u7d50\u675f\u5c0d\u8a71\u55ce\uff1f",formSubmitHandler:function(e){e.preventDefault();var t=e.target.parentElement.parentElement;"endchat-modal"===t.id?("confirm-btn"===e.target.className&&xe(),t.classList.remove("opened")):console.error("ERROR: Parent Element is not an end chat modal!")}}),Object(h.jsx)(b,{modalId:"startchat-modal",confirmText:"\u4f60\u78ba\u5b9a\u8981\u958b\u555f\u65b0\u5c0d\u8a71\u55ce\uff1f",formSubmitHandler:function(e){e.preventDefault();var t=e.target.parentElement.parentElement;"startchat-modal"===t.id?("confirm-btn"===e.target.className&&(we(),pe()),t.classList.remove("opened")):console.error("ERROR: Parent Element is not a start chat modal!")}}),(F||G)&&Object(h.jsx)(O,{}),Object(h.jsxs)("div",{className:"chat-container",children:[null!=H&&Object(h.jsxs)("p",{className:"disconnect-msg",children:["\u4f7f\u7528\u8005\u5df2\u65bc",Ee(H),"\u958b\u59cb\u96e2\u7dda\u3002"]}),Object(h.jsx)("div",{ref:p,className:"messages-container",children:_.map((function(n,r){return Object(h.jsxs)("p",{className:"message "+(n.spc?"special":n.uid===e.currentUser.uid?"right":"left"),children:[n.msg?n.msg:t[n.spc]?t[n.spc]:t.clientId,Object(h.jsx)("span",{children:Ee(n.time)})]},n.chatId)}))}),Object(h.jsxs)("div",{className:"special-char-container",children:[Object(h.jsx)("button",{className:"back-arrow",onClick:Se,children:Object(h.jsx)("span",{className:"material-icons",children:"arrow_back_ios"})}),["\u5572","\u5481","\u55f0","\u5497","\u55ba","\u4fc2","\u54cb","\u5514","\u54a9","\u54aa","\u5605","\u35ce","\u558e","\u5622","\u569f","\u56c9","\u4e5c","\u53fb","\u5462","\u5571","\u7747","\u8ad7","\u564f","\u5625","\u6652","\u548b","\u7793","\u551e","\u6c39","\u6530","\u4ffe","\u9582","\u5440","\u5566","\u51a7","\u664f","\u5b32","\u5587"].map((function(e,t){return Object(h.jsx)("button",{className:"spc-char",onClick:ke,children:e},"spc-char"+t)})),Object(h.jsx)("button",{className:"forward-arrow",onClick:Se,children:Object(h.jsx)("span",{className:"material-icons",children:"arrow_forward_ios"})})]}),Object(h.jsxs)("form",{className:"input-container",onSubmit:Oe,children:[ae&&Object(h.jsx)("p",{className:"typing-msg",children:"\u4f7f\u7528\u8005\u6b63\u5728\u8f38\u5165..."}),Object(h.jsx)("button",{type:"button",name:"emoji-btn",id:"emoji-btn",onClick:function(){he(!me)},children:Object(h.jsx)("span",{className:"material-icons",children:"emoji_emotions"})}),Object(h.jsx)("input",{type:"text",name:"msg-input",id:"msg-input",placeholder:"\u6309\u6b64\u5c0d\u8a71\u2026",onInput:function(t){if(I){var n=""!=t.target.value;n!=ie&&(c?(le(n),c.child(e.currentUser.uid).set(n)):console.error("ERROR: Typing Status reference not available!"))}}}),Object(h.jsx)("button",{type:"submit",name:"submit-btn",id:"submit-btn",children:Object(h.jsx)("span",{className:"material-icons",children:"send"})})]}),me&&Object(h.jsx)(w.a,{onEmojiClick:function(e,t){console.log(t.emoji);var n=document.querySelector(".chatroom .chat-container .input-container #msg-input"),r=n.value.substring(0,n.selectionStart),a=n.value.substring(n.selectionEnd,n.value.length);0===n.selectionStart&&0===n.selectionEnd&&(r=n.value,a=""),n.value=r+t.emoji+a,n.focus(),n.setSelectionRange(r.length+2,r.length+2)}})]}),Object(h.jsxs)("div",{className:"queue-container",children:[Object(h.jsxs)("p",{className:"main-text",children:[Object(h.jsx)("span",{className:"material-icons",children:"people"}),Object(h.jsx)("span",{className:"queue-count",children:y.length})]}),Object(h.jsx)("div",{ref:x,className:"clients-container",children:y.map((function(e,t){return Object(h.jsxs)("p",{className:"queue-client"+("roomAssigned"===e.status?" assigned":""),children:["Client ",Object(h.jsx)("span",{className:"client-id",children:e.userId}),Object(h.jsxs)("span",{className:"enqueue-time","data-time":e.time,children:["roomAssigned"===e.status?"\u88ab\u63a5\u6536":"\u5165\u968a","\u6642\u9593: ",Ee(e.time)]})]},e.userId)}))}),Object(h.jsxs)("div",{className:"buttons-container",children:[Object(h.jsx)("button",{type:"submit",name:"start-btn",id:"start-btn",disabled:null!=I||y.length<=0,onClick:function(){document.getElementById("startchat-modal").classList.add("opened")},children:"\u958b\u59cb\u5c0d\u8a71"}),Object(h.jsx)("button",{type:"submit",name:"end-btn",id:"end-btn",disabled:null==I,onClick:function(){document.getElementById("endchat-modal").classList.add("opened")},children:"\u7d50\u675f\u5c0d\u8a71"})]})]}),Object(h.jsx)("button",{className:"queue-toggle",onClick:we,children:Object(h.jsx)("span",{className:"material-icons",children:ee?"chat":"contacts"})})]})},y=(n(53),function(){return Object(h.jsx)("div",{className:"dashboard",children:Object(h.jsx)("h1",{children:"WORK IN PROGRESS"})})}),N=(n(54),function(e){return Object(h.jsxs)("div",{className:"login",children:[Object(h.jsx)("h1",{className:"main-text",children:"HeartlineHK Login"}),Object(h.jsxs)("form",{className:"login-form",onSubmit:e.handleLogin,children:[Object(h.jsx)("label",{htmlFor:"login-email",children:"Email:"}),Object(h.jsx)("input",{type:"email",name:"login-email",id:"login-email",required:!0}),Object(h.jsx)("label",{htmlFor:"login-pwd",children:"Password:"}),Object(h.jsx)("input",{type:"password",name:"login-password",id:"login-password",required:!0}),Object(h.jsx)("input",{type:"submit",value:"Login",name:"login-submit",id:"login-submit"})]})]})});var R=function(){var e=v.a.database().ref("online_time"),t=Object(r.useState)(null),n=Object(u.a)(t,2),a=n[0],s=n[1],o=Object(r.useState)(!1),c=Object(u.a)(o,2),g=c[0],O=c[1],k=Object(r.useState)(v.a.auth()),w=Object(u.a)(k,2),S=w[0],R=(w[1],function(e){null!=e.val()&&(e.val().uid!=sessionStorage.getItem("heartlinehk-agentUid")&&(document.getElementById("auto-logout-modal").classList.add("opened"),I(!0)))}),C=function(){var t=Object(l.a)(i.a.mark((function t(n){var r,a,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),g){t.next=24;break}return O(!0),r=document.getElementById("login-email").value,a=document.getElementById("login-password").value,t.prev=5,t.next=8,S.setPersistence(v.a.auth.Auth.Persistence.SESSION);case 8:return t.next=10,S.signInWithEmailAndPassword(r,a);case 10:return console.log(S.currentUser),null===sessionStorage.getItem("heartlinehk-agentUid")&&(console.log("No UID found, generate now!"),sessionStorage.setItem("heartlinehk-agentUid",M(12))),s=sessionStorage.getItem("heartlinehk-agentUid"),t.next=15,e.child(S.currentUser.uid).set({uid:s,time:v.a.database.ServerValue.TIMESTAMP});case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(5),console.error(t.t0.message),alert(t.t0.message);case 21:O(!1),t.next=26;break;case 24:console.error("Already logging in"),alert("Already logging in!");case 26:case"end":return t.stop()}}),t,null,[[5,17]])})));return function(e){return t.apply(this,arguments)}}(),I=function(){var t=Object(l.a)(i.a.mark((function t(){var n,r=arguments;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.length>0&&void 0!==r[0]&&r[0],t.prev=1,e.child(S.currentUser.uid).off("value"),n){t.next=6;break}return t.next=6,e.child(S.currentUser.uid).remove();case 6:return t.next=8,S.signOut();case 8:console.log("Signed out!"),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(1),console.error(t.t0.message),alert(t.t0.message);case 15:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(){return t.apply(this,arguments)}}(),M=function(e){for(var t="",n=0,r=26,a=97,s=0;s<e;s++)r=0===(n=Math.floor(3*Math.random()))||1===n?26:10,a=0===n?97:1===n?65:48,t+=String.fromCharCode(Math.floor(Math.random()*r)+a);return t};return Object(r.useEffect)((function(){return v.a.auth().onAuthStateChanged((function(t){t?(s(t),e.child(t.uid).off("value"),e.child(t.uid).on("value",R)):s(null)}))})),Object(r.useEffect)((function(){var e=function(){var e=.01*window.innerHeight;console.log(e),console.log(window.innerHeight),document.documentElement.style.setProperty("--vh","".concat(e,"px"))};e(),window.addEventListener("resize",e)}),[]),Object(h.jsx)(d.a,{children:Object(h.jsxs)("div",{className:"App",style:{width:"100vw",minHeight:"calc(100 * var(--vh, 1vh))",position:"relative",backgroundColor:"rgba(0,0,0,0.05)",display:"flex",flexDirection:"row",overflow:"hidden"},children:[Object(h.jsx)(f,{modalId:"auto-logout-modal",noticeText:"\u7531\u65bc\u6b64\u5e33\u865f\u5df2\u65bc\u53e6\u4e00\u88dd\u7f6e/\u8996\u7a97\u4e0a\u767b\u5165\uff0c\u6b64\u8996\u7a97\u5c07\u6703\u767b\u51fa\u5e33\u865f\u3002",formSubmitHandler:function(e){e.preventDefault();var t=e.target.parentElement.parentElement;"auto-logout-modal"===t.id?t.classList.remove("opened"):console.error("ERROR: Parent Element is not a logout modal!")}}),!a&&Object(h.jsx)(N,{handleLogin:C}),a&&Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(b,{modalId:"logout-modal",confirmText:"\u4f60\u78ba\u5b9a\u8981\u767b\u51fa\u55ce\uff1f",formSubmitHandler:function(e){e.preventDefault();var t=e.target.parentElement.parentElement;"logout-modal"===t.id?("confirm-btn"===e.target.className&&I(),t.classList.remove("opened")):console.error("ERROR: Parent Element is not a logout modal!")}}),Object(h.jsx)(j,{currentUser:a,handleLogout:function(){document.getElementById("logout-modal").classList.add("opened")}}),Object(h.jsxs)(m.c,{children:[Object(h.jsx)(m.a,{exact:!0,path:"/chatroom",children:Object(h.jsx)(E,{currentUser:a})}),Object(h.jsx)(m.a,{exact:!0,path:"/supervisor",children:Object(h.jsx)(x,{currentUser:a})}),Object(h.jsx)(m.a,{exact:!0,path:"/profile-update",children:Object(h.jsx)(p,{currentUser:a})}),Object(h.jsx)(m.a,{path:"/",children:Object(h.jsx)(y,{currentUser:a})})]})]})]})})};v.a.initializeApp({apiKey:"AIzaSyD-gB_LHwUq2qiUXdDt2CAxGCYQQla4hMo",authDomain:"heartlinehk-8e3ec.firebaseapp.com",databaseURL:"https://heartlinehk-8e3ec-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"heartlinehk-8e3ec",storageBucket:"heartlinehk-8e3ec.appspot.com",messagingSenderId:"1077537941035",appId:"1:1077537941035:web:f5b566fde9a2363a2d6c6e",measurementId:"G-S9JD41562T"}),o.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(R,{})}),document.getElementById("root"))}},[[55,1,2]]]);
//# sourceMappingURL=main.9377af1f.chunk.js.map